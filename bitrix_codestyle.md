
## Оглавление

* [Общее](#common)
* [Базовый набор знаний](#base)
* [Разработка](#programming)
    * [Постулаты разработки bitrix проектов](#theory)
    * [Практика разработки bitrix проектов](#practics)
    * [Внесение изменений](#changes)
    * [Гигиена разработки](#cleanup)
* [Правила именования](#naming)
* [Структура проекта](#structure)
    * [Статика](#static)
    * [Включаемые области](#includes)
    * [Файловая структура](#files)
* [Расширение стандартного функционала](#extensions)


## <a id="common"></a>Общее

* Вы **ОБЯЗАНЫ** использовать кодировку UTF-8 для всех файлов bitrix и для кодировки БД.

* Вы **ОБЯЗАНЫ** использовать отступ в 2 пробела в `.php` файлах шаблонов, для остальных `.php` файлов вы **ОБЯЗАНЫ** использовать отступ в 4 пробела



## <a id="base"></a>Базовый набор знаний

* Вам **СЛЕДУЕТ** понимать и знать [порядок выполнения страницы](https://dev.1c-bitrix.ru/api_help/main/general/page/pageplan.php)

* Вам **СЛЕДУЕТ** понимать и знать [специальные константы](https://dev.1c-bitrix.ru/api_help/main/general/constants.php)

* Вам **СЛЕДУЕТ** понимать и знать [передачу данных в компонентах](http://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&LESSON_ID=3043&LESSON_PATH=3913.4776.4774.3043)

* Вам **СЛЕДУЕТ** понимать и знать что из себя представляют и как работают [модули bitrix](http://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&CHAPTER_ID=04609&LESSON_PATH=3913.4609)

* Вам **СЛЕДУЕТ** понимать и знать что из себя представляют и как работают [компоненты bitrix](http://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&CHAPTER_ID=04565&LESSON_PATH=3913.4565)

* В Bitrix есть такое понятие как "События", которые вызывают выполнение определенного кода по наступлению определенного события. Почти все головоломки можно решить с помощью событий. Событий очень много, вам **СЛЕДУЕТ** ознакомиться с ними в [Bitrix API](http://dev.1c-bitrix.ru/api_help/). Регистрировать обработчик события можно в файле `init.php`. [События](http://dev.1c-bitrix.ru/api_help/) модуля инфоблоков;

```php
<?php 

// файл /bitrix/php_interface/init.php
// регистрируем обработчик
AddEventHandler("iblock", "OnBeforeIBlockElementAdd", Array("MyClass", "OnBeforeIBlockElementAddHandler"));

class MyClass
{
    // создаем обработчик события "OnBeforeIBlockElementAdd"
    function onBeforeIBlockElementAddHandler(&$arFields)
    {
        if (strlen($arFields["CODE"]) <= 0) {
            global $APPLICATION;
            $APPLICATION->throwException("Введите мнемонический код.");
            return false;
        }
    }
}
?>
```


## <a id="programming"></a>Разработка

### <a id="theory"></a>Постулаты разработки bitrix проектов

* Вам **СЛЕДУЕТ** использовать стандартные компоненты для решения типовых задач(процент которых очень велик), а не писать свои компоненты и куски кода для решения такого рода задач.

* Вы **ОБЯЗАНЫ НЕ** обращаться к БД напрямую(вне модулей), изменять её. Все действия с БД **ОБЯЗАНЫ** происходить только через bitrix API. Структура данных может меняться от версии к версии, а функции сохраняют обратную совместимость.

* Вам **СЛЕДУЕТ НЕ** писать код HTML в код PHP для изменения представления данных. Логика - это сам компонент, представление - это шаблон вывода компонента. Шаблон существенно проще, чем компонент в целом. Нет необходимости изменять логику компонента для изменения особенностей показа его данных. Для одной логики может быть несколько представлений, в том числе зависящих от шаблона текущего сайта.

* Собственные компоненты и шаблоны - **ОБЯЗАНЫ** находиться в собственном пространстве имен. Кастомизируя штатные компоненты и шаблоны, разрабатывая собственные, размещайте их в собственном пространстве имен. При обновлении системы все внесенные изменения в пространстве bitrix затираются.

* Вы **ОБЯЗАНЫ НЕ** править код ядра в силу нескольких причин:

    1. При обновлении системы внесенные изменения затрутся

    2. При изменении ядра владелец лицензии теряет право на техническую поддержку

    3. При изменении ядра разработчиком сайта возможна некорректная работа системы, так как ядро - сложная система, требующая учета работы всех модулей.
    > Ядро продукта - файлы, находящиеся в директории `/bitrix/modules/` а так же файлы системных компонентов: `/bitrix/components/bitrix/`.

### <a id="practics"></a>Практика разработки bitrix проектов

* Вы **ОБЯЗАНЫ** писать свои функции, подключать библиотеки только в файле `init.php` который находится в `/bitrix/php_interface/`, причем вам **СЛЕДУЕТ** соблюдать следующие правила:

    1. `init.php` содержит только подключения файлов

    2. Если функционал используется только на одном из сайтов в системе, то он выносится в свой `/SITE_ID/init.php`

    3. Обработчики событий лучше группировать в одном файле и тщательно аннотировать где они используются и какая задача перед ними стоит

```php
<?php
    require_once dirname(__FILE__) . '/my_custom_func.php';
?>
```

* Добавление частной логики при кастомизации шаблона компонента ОБЯЗАНО происходить только через файл `result_modifier.php` который должен быть расположен в шаблоне компонента. В этом файле можно переопределить или дополнить массив `$arResult` который в свою очередь выводиться в самом файле шаблона `template.php`

```php
<?php 
foreach ($arResult["ITEMS"] as $key => &$item) {
    $item["NEW_FIELD"] = $item["NAME"] . $item['ID'];
}
?>
```

* При необходимости модификации данных компонента с включенным кешированием вы **ОБЯЗАНЫ** использовать файл `component_epilog.php` который необходимо положить в шаблон компонента. Данный файл подключается после выполнения шаблона

* Файлы, к которым нельзя обращаться напрямую (они не должны выполняться, будучи вызванными напрямую по адресу в браузере), **ОБЯЗАНЫ** содержать в начале следующий код проверки:

```php
<?php
if(!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED!==true)die();
?>
```

К таким файлам относится все, что работает внутри продукта, например: шаблоны сайтов, шаблоны компонента, файлы `.parameters.php` и `.description.php`.

* Для реализации AJAX вы **ОБЯЗАНЫ НЕ** создавать дополнительного шаблона для этих целей, а использовать следующую конструкцию:

```php
<?php
define("STOP_STATISTICS", true);
require_once($_SERVER["DOCUMENT_ROOT"]."/bitrix/modules/main/bx_root.php");
require_once($_SERVER["DOCUMENT_ROOT"]."/bitrix/modules/main/include/prolog_before.php");

// если нужна капча
require_once($_SERVER["DOCUMENT_ROOT"]."/bitrix/modules/main/classes/general/captcha.php"); 

// логика работы...

?>
```

### <a id="changes"></a>Внесение изменений

Способы внесения изменений и порядок их применения, которого вы **ОБЯЗАНЫ** придерживаться:

1. Сначала попытайтесь сделать это [редактированием шаблона](http://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&CHAPTER_ID=1103) самого сайта и файлов CSS

2. Если предыдущее невозможно, то попытайтесь сделать это средствами [редактирования страницы](http://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&LESSON_ID=2885) сайта
> Примечание: К этому пункту нужно подходить осторожно. Бездумное добавление кода может привести к тому, что компоненты будут обрамляться кодом, который должен быть в шаблоне компонента, а не на странице

3. При невозможности реализации задачи с помощью первых вариантов переходите к [редактированию шаблонов компонента](http://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&CHAPTER_ID=999) и файлов CSS компонента, либо изменяйте вывод данных с помощью файлов [result_modifier.php и component_epilog.php](http://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&CHAPTER_ID=1010)

4. Используйте [обработчики событий](http://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&CHAPTER_ID=1027), которые позволяют решать очень широкий спектр задач

5. [Кастомизация компонента](http://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&CHAPTER_ID=1000) или разработка [собственного компонента](http://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&CHAPTER_ID=998) или [модуля](http://dev.1c-bitrix.ru/learning/course/index.php?COURSE_ID=43&CHAPTER_ID=1013) - последний из возможных вариантов получения нештатного функционала.

### <a id="cleanup"></a>Гигиена разработки

* Вы **ОБЯЗАНЫ** удалять неиспользуемый, сгенерированный bitrix'ом код для ваших шаблонов компонент, вызовов простых компонент в комплексных компонентах.

* ВЫ **ОБЯЗАНЫ** удалять неиспользуемые, сгенерированные bitrix'ом файлы для ваших шаблонов компонент(простых и комплексных)

* ВЫ **ОБЯЗАНЫ** удалять неиспользуемые, сгенерированные bitrix'ом простые компоненты для комплексных компонент.




## <a id="naming"></a>Правила именования

Следующие правила именования наследуют и расширяют правила, описанные в PHP code style PSR 1/2/3.

* Массивы **СЛЕДУЕТ** именовать с префиксом `ar`, при этом общий формат написание идентификатора - camelCase. Например, `$arResult`, `$arModifiedUsers`

* Объект класса CDBResult **СЛЕДУЕТ** начинать с префикса `db`, при этом общий формат написание идентификатора - camelCase. Например, `$dbResult`

* Именование индексов массивов **СЛЕДУЕТ** писать в формате "UPPER_CASE"  с разделением слов символом подчеркивания(`_`). Это общепринятая норма bitrix сообщества 

```php
<?php
$arSelect = Array("ID", "NAME", "DATE_ACTIVE_FROM");
$arFilter = Array("IBLOCK_ID"=>IntVal($yvalue), "ACTIVE_DATE"=>"Y", "ACTIVE"=>"Y");

$dbItems = CIBlockElement::GetList(Array(), $arFilter, false, Array("nPageSize"=>50), $arSelect);
while ($ob = $dbItems->GetNextElement()) {
    $arFields = $ob->GetFields();
    print_r($arFields);
}
?>
```

* Вы **ОБЯЗАНЫ** именовать файлы и папки только в формате `under_score`. Например, `main`, `php_interface`

* При создании шаблона компонента или шаблона сайта вы **ОБЯЗАНЫ** назвать шаблон `main`, если необходимо создать только один шаблон. Вам **СЛЕДУЕТ** назвать шаблон `main`, если у вас будет несколько шаблонов одного и того же компонента и один из них будет выполнять более важную роль, нежели другой(ие). Данное правило не распространяется на равноценные по значимости шаблоны, например `paginator_top`, `paginator_bottom`

* Вы ОБЯЗАНЫ использовать формат `lower_case` для именования следующих сущностей:

    * Идентификатор (ID) сайтов

    * Идентификатор (ID) шаблонов сайтов

    * Идентификатор (ID) шаблонов компонент

    * Идентификатор (ID) типов инфоблоков

    * Символьный код инфобоков

    * Символьный код разделов инфоблоков

    * Символьный код элементов инфоблоков

* Вы ОБЯЗАНЫ использовать формат `UPPER_CASE` для именования следующих сущностей:

    * Названия типов почтовых событий

    * Код пользовательских свойств

    * Код свойств элементов инфоблоков

* Вам **СЛЕДУЕТ** грамотно именовать файлы, папки, разделы и другие сущность bitrix.

> Плохой пример: o_kompanii

> Хороший пример: about


## <a id="structure"></a>Структура проекта

### <a id="static"></a>Статика

Вам СЛЕДУЕТ выносить всю статику:

* Изображения

* JavaScript

* Стили(css, less)

в корень сайта в папку `static`, если:

1. У вас один шаблон для сайта(ов)

2. У вас несколько шаблонов для сайта(ов), но они имеют много общего.

### <a id="includes"></a>Включаемые области

Вам **СЛЕДУЕТ** располагать все файлы включаемых областей в папке `includes` корня сайта.


### <a id="files"></a>Файловая структура

Вы **ОБЯЗАНЫ** формировать файловую структуру, аналогичную представленной:

```diff
+ docs                          # корень сайта
  + my_folder_1                 # произвольная директория
    - index.php
    - my_file_1.php

  + my_folder_2
    - index.php 

  + static                      # вся статика 
    + img
      + icons
        - facebook.png
        - arrow.png
        ...
      + bg
        - main.png
        - list.png
        ...
      + tmp
        - foto1.jpg
        ...
    + css 
      - style.less              # основные стили
      - normalize.css
      + vendor                  # стили для плагинов
        - placeholder.css
        + fancybox
          - fancybox.css
          - fancybox_style.css
        ...
    + js 
      - main.js                 # приложение 
      + vendor                  # js библиотеки (less, jquery) 
        - jquery.js
        - fancybox.js
        - less.js
        ...

  + includes                    # директория с включаемыми файлами
    - address.php
    - phone.php
    ...

  + bitrix
    + components                # компоненты butrix
      + butrix
        ...
      + custom                  # кастомные(самописные) компоненты butrix
        + call
        + my_component
    + modules                   # модули butrix
      ...
      + my_module
      ...
    + templates                 # шаблоны butrix
      + main                    # основной шаблон
        + components
          + bitrix
            + new.list
              + main
            ...
        - header.php
        - footer.php
        ...
    + php_interface
      ...
      + init.php
      + my_functions_1.php      # кастомные функции
      + my_functions_2.php
      ...

  - index.php
  - my_file.php
  ...
```

> Замечание: Если возникает необходимость использовать разную статику для разных шаблонов, вы ОБЯЗАНЫ создать дочернюю директорию в `/static` и хранить
> в ней статику для одноименного шаблона bitrix.

## <a id="extensions"></a>Расширение стандартного функционала

* При невозможности решить задачу стандартным функционалом, который предоставляется bitrix посредством системных модулей(API) и компонент **СЛЕДУЕТ** воспользоваться корпоративным модулем, который расширяет стандартный функционал. В случае, если задача не может быть решена посредством данных решений, вы **ОБЯЗАНЫ**:

    1. Реализовать собственный компонент в пространстве имен `custom` если задача сопряжена с работой пользователя в публичной части(представление), например компоненты: "Заказать звонок", "Обратная связь" и тд

    2. Реализовать собственный модуль, если задача сопряжена с созданием собственной структуры таблиц БД, наборами компонент для работы пользователя

    3. Реализовать собственный класс, если задача сопряжена с обработкой данных и не сопряжена с работой пользователя в публичной части(представление). Вы **ОБЯЗАНЫ** подключить файл с классом в файле `init.php`
